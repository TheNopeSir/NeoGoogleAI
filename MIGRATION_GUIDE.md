# üîÑ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞

–°—Ç–∞—Ä—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç base64 Data URI –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ:
- –ó–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –ú–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- –ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

–ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–∏—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞–∫ —Ñ–∞–π–ª—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ WebP —Å —Ç—Ä–µ–º—è —Ä–∞–∑–º–µ—Ä–∞–º–∏:
- `thumbnail` - 300x300px (60% –∫–∞—á–µ—Å—Ç–≤–æ) - –¥–ª—è –ø—Ä–µ–≤—å—é
- `medium` - 800x800px (75% –∫–∞—á–µ—Å—Ç–≤–æ) - –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- `large` - 1200x1200px (85% –∫–∞—á–µ—Å—Ç–≤–æ) - –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

## –î–≤–∞ —Å–ø–æ—Å–æ–±–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Å–ø–æ—Å–æ–±, –µ—Å–ª–∏:
- –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å–µ—Ç–∏
- –£ –≤–∞—Å –Ω–µ—Ç –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
npm start

# 2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
node migrateImagesViaAPI.js

# 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
node migrateImagesViaAPI.js --dry-run

# 4. –ú–∏–≥—Ä–∏—Ä—É–π—Ç–µ –í–°–ï –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
node migrateImagesViaAPI.js --execute

# 5. –ò–ª–∏ –º–∏–≥—Ä–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ N –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (–¥–ª—è —Ç–µ—Å—Ç–∞)
node migrateImagesViaAPI.js --execute --limit 5
```

### –°–ø–æ—Å–æ–± 2: –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –ë–î (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç —Å–ø–æ—Å–æ–±, –µ—Å–ª–∏:
- –£ –≤–∞—Å –µ—Å—Ç—å –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- –§–∞–π–ª `.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å `DATABASE_URL`

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ .env —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç DATABASE_URL
cat .env | grep DATABASE_URL

# 2. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
node migrateImages.js

# 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
node migrateImages.js --dry-run

# 4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
node migrateImages.js --execute
```

## –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏?

1. **–ê–Ω–∞–ª–∏–∑ –ë–î** - —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ –Ω–∞—Ö–æ–¥–∏—Ç —Ç–µ, —É –∫–æ—Ç–æ—Ä—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ base64
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –¥–ª—è –∫–∞–∂–¥–æ–≥–æ base64 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
   - –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ base64 ‚Üí Buffer
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ö–µ—à–∞ (SHA-256)
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ—Ö –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π –≤ WebP
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `uploads/images/{exhibitId}/{hash}_{size}.webp`
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î** - –∑–∞–º–µ–Ω–∞ base64 Data URI –Ω–∞ –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º

## –ü—Ä–∏–º–µ—Ä –¥–æ –∏ –ø–æ—Å–ª–µ

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
```json
{
  "imageUrls": [
    "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD..."
  ]
}
```
–†–∞–∑–º–µ—Ä –≤ –ë–î: ~500-1000 –ö–ë –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:
```json
{
  "imageUrls": [
    {
      "success": true,
      "thumbnail": "/api/images/61760c79-52b5/a98f3abe34a3_thumbnail.webp",
      "medium": "/api/images/61760c79-52b5/a98f3abe34a3_medium.webp",
      "large": "/api/images/61760c79-52b5/a98f3abe34a3_large.webp",
      "originalFormat": "jpeg",
      "originalWidth": 2000,
      "originalHeight": 1500
    }
  ]
}
```
–†–∞–∑–º–µ—Ä –≤ –ë–î: ~200 –±–∞–π—Ç (—Ç–æ–ª—å–∫–æ –ø—É—Ç–∏)
–†–∞–∑–º–µ—Ä –Ω–∞ –¥–∏—Å–∫–µ: ~30 –ö–ë (thumbnail) + ~80 –ö–ë (medium) + ~150 –ö–ë (large)

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (`--dry-run`) –Ω–µ –≤–Ω–æ—Å–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –ú–æ–∂–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ —á–∞—Å—Ç—è–º (`--limit N`)
- ‚úÖ –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å
- ‚ö†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π!**

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–í –±—Ä–∞—É–∑–µ—Ä–µ** - –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
2. **–í —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ**:
   ```bash
   ls -lh uploads/images/
   ```
3. **–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞** - –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏ `[ImageProcessor] Saved...`

## –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "Cannot find package 'pg'"
```bash
npm install
```

### "ECONNREFUSED 127.0.0.1:5432" (–¥–ª—è migrateImages.js)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `migrateImagesViaAPI.js` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î
- –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `.env` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º `DATABASE_URL`

### "API Error: 401 Unauthorized" (–¥–ª—è migrateImagesViaAPI.js)
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
- –í–æ–∑–º–æ–∂–Ω–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –¥–æ–±–∞–≤—å—Ç–µ `AUTH_TOKEN` –≤ `.env`

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Å—ë —Ä–∞–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç 404
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É: `ls -la uploads/images/`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–∞–ø–∫–µ `uploads/`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

–ù–æ–≤—ã–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏! –ö–æ–¥ –≤ `server.js:747`:

```javascript
const processedImages = await processExhibitImages(base64Images, recordId);
```

–ú–∏–≥—Ä–∞—Ü–∏—è –Ω—É–∂–Ω–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è **—Å—Ç–∞—Ä—ã—Ö** –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –¥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.
