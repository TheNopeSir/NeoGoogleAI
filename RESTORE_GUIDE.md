# Руководство по восстановлению данных

## Упрощение системы реакций

Система реакций была упрощена с 6 типов (LIKE, FIRE, HEART, STAR, TROPHY, COOL) до одного типа - LIKE (лайки).

### Что было изменено:

1. **Типы и интерфейсы**:
   - `types.ts`: ReactionType теперь только 'LIKE'
   - `constants.ts`: REACTION_CONFIG содержит только LIKE

2. **Компоненты**:
   - `ReactionPicker.tsx`: Упрощен до простой кнопки лайка (без выпадающего меню)
   - `ExhibitCard.tsx`, `FeedView.tsx`, `SearchView.tsx`, `UserProfileView.tsx`, `MyCollection.tsx`: Обновлены сигнатуры onReact

3. **Утилиты**:
   - `utils/reactionUtils.ts`: Упрощена логика toggle для работы только с лайками

4. **Основное приложение**:
   - `App.tsx`: handleReaction больше не принимает reactionType

### Миграция данных

Для конвертации всех существующих реакций в LIKE и восстановления счетчиков:

```bash
# Запустить миграцию реакций
node migrateReactions.js
```

Этот скрипт:
- Конвертирует все типы реакций (FIRE, HEART, STAR, TROPHY, COOL) в LIKE
- Сохраняет всех пользователей, которые реагировали (независимо от типа реакции)
- Восстанавливает корректные счетчики likes и likedBy
- Проверяет и исправляет счетчики просмотров (views)

### Проверка гостевой книги

Для проверки состояния гостевой книги:

```bash
# Проверить содержимое гостевой книги
node verifyGuestbook.js
```

## Гостевая книга

Гостевая книга использует отдельную таблицу `guestbook` в базе данных. Каждая запись содержит:
- `id`: Уникальный идентификатор
- `author`: Автор записи
- `targetUser`: Пользователь, на чьей странице оставлена запись
- `text`: Текст записи
- `timestamp`: Время создания
- `isRead`: Прочитана ли запись

Если записи гостевой книги были удалены, восстановление возможно только из резервной копии базы данных.

## Проверка после миграции

После запуска миграции:

1. Проверьте, что все лайки сохранены и счетчики корректны
2. Убедитесь, что счетчики просмотров не сбросились
3. Проверьте работу кнопки лайка в интерфейсе
4. Убедитесь, что уведомления о лайках работают

## Откат изменений

Если нужно откатить изменения:

```bash
git revert HEAD
```

Однако учтите, что данные в базе данных (после миграции) уже будут изменены.
